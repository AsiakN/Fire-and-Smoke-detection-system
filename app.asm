ORG 00H

E EQU P3.2
RS EQU P3.4
RW EQU P3.3

PMP EQU P1.1
;RED EQU P1.5
;GREEN EQU P1.6

GSENS EQU P1.2
FSENS EQU P1.0
BULB EQU P0.1
BUZZER EQU P1.3

SETB GSENS
SETB FSENS
MOV TMOD,#00000001B

MAIN:

	
	ACALL INIT
	CLR P1.0 ;remove FSENSOR though
	CLR P1.2 ;remove gSENSOR though
	ACALL OT; original text
	JNB P1.0, FSENSORON; if no bit activate pump
	JNB P1.2, GSENSORON; if no bit activate pump
	CLR PMP
	ACALL CMD
	
	
	ACALL MAIN
	
	
	


INIT:
	MOV A,#0CH 
 	ACALL WCMD
 	ACALL DELAY
 	MOV A,#01H 
 	ACALL WCMD
 	ACALL DELAY
 	MOV A,#06H 
 	ACALL WCMD
 	ACALL DELAY
 	MOV A,#80H 
 	ACALL WCMD
 	ACALL DELAY
 	MOV A,#3CH 
 	ACALL WCMD
 	ACALL DELAY
	RET


FSENSORON:
	
	ACALL CMD
	ACALL ONTXT1
	SETB PMP
	SETB BUZZER
	SETB BULB ; on lamp
	;else
	ACALL OFFTXT1
	ACALL MAIN
	
GSENSORON:
	
	ACALL CMD
	ACALL ONTXT2
	SETB PMP
	SETB BUZZER
	CLR BULB ; on lamp
	;ELSE
	CLR PMP
	CLR BUZZER
	ACALL OFFTXT2
	ACALL MAIN



DELAY:
	MOV R6, #255
D1L1:
	MOV R7, #255
	DJNZ R7, $
	DJNZ R6, D1L1
	RET
CMD:
	MOV A,#0C0H 
 	ACALL WCMD 
	RET

DISPLAY:
;send text to LCD
	MOV P2, A
	SETB RS
	CLR RW
	SETB E
	ACALL DELAY
	CLR E
	RET

WCMD:
;write command to LCD
	MOV P2, A
	CLR RS
	CLR RW
	SETB E
	ACALL DELAY
	CLR E
	RET


OT:
	MOV A,#"w"
 	ACALL DISPLAY
 	ACALL DELAY
 	ACALL DELAY
 	MOV A,#"E"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"i" 
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"s"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"t"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"u"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"r"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"e"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#" "
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"C"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"h"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"e"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"c"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"k"
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"."
	ACALL DISPLAY
	ACALL DELAY
	MOV A,#"."
	ACALL DISPLAY
	ACALL DELAY
	RET
ONTXT1:
	;fire and smoke detected
	MOV A,#"S"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"M"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"O"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"K"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"F" 
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"D"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"T"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"C"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"T"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"D"
 	ACALL DISPLAY
 	ACALL DELAY
	RET
	
	
ONTXT2:
	;smoke detected
	MOV A,#"S"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"M"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"O"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"K"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#" " 
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"D"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"T"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"C"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"T"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"E"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"D"
 	ACALL DISPLAY
 	ACALL DELAY
	RET


	
OFFTXT1:
	;no smoke detected
	MOV A,#"N"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"o"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#" "
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"s"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"m"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"o" 
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"k"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"e"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#" "
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"d"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"e"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"t"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"e"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"c"
	ACALL DISPLAY
 	ACALL DELAY
	RET
	
	
OFFTXT2:
	;no fire dectected
	MOV A,#"N"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"o"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#" "
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"F"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"i"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"r" 
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"e"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#" "
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"d"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"e"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"t"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"e"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"c"
 	ACALL DISPLAY
 	ACALL DELAY
 	MOV A,#"t"
	ACALL DISPLAY
 	ACALL DELAY
	RET
	
	
	
	
	
END
